---
name: zilla-mqtt-kafka-broker
catalogs:
  catalog0:
    type: filesystem
    options:
      subjects:
        mqtt:
          path: mqtt/mqtt-asyncapi.yaml
        kafka:
          path: kafka/kafka-asyncapi.yaml
bindings:
  asyncapi_mqtt0:
    type: asyncapi
    kind: server
    options:
      specs:
        mqtt_api:
          catalog:
            catalog0:
              subject: mqtt
              version: latest
    exit: asyncapi_proxy0
  asyncapi_proxy0:
    type: asyncapi
    kind: proxy
    options:
      specs:
        mqtt_api:
          catalog:
            catalog0:
              subject: mqtt
              version: latest
        kafka_api:
          catalog:
            catalog0:
              subject: kafka
              version: latest
      mqtt-kafka:
        channels:
          sessions: mqttSessions
          retained: mqttRetained
          messages: mqttMessages
    routes:
      - when:
          - api-id: mqtt_api
            operation-id: turnOn
        exit: asyncapi_kafka0
        with:
          api-id: kafka_api
          operation-id: toStreetlightData
      - when:
          - api-id: mqtt_api
            operation-id: receiveLightMeasurement
        exit: asyncapi_kafka0
        with:
          api-id: kafka_api
          operation-id: onStreetlightData
      - when:
          - api-id: mqtt_api
            operation-id: sendLightMeasurement
        exit: asyncapi_kafka0
        with:
          api-id: kafka_api
          operation-id: toStreetlightData
      - when:
          - api-id: mqtt_api
            operation-id: turnOff
        exit: asyncapi_kafka0
        with:
          api-id: kafka_api
          operation-id: toStreetlightData
      - when:
          - api-id: mqtt_api
            operation-id: dimLight
        exit: asyncapi_kafka0
        with:
          api-id: kafka_api
          operation-id: toStreetlightData
  asyncapi_kafka0:
    type: asyncapi
    kind: client
    options:
      specs:
        kafka_api:
          catalog:
            catalog0:
              subject: kafka
              version: latest
telemetry:
  exporters:
    stdout_exporter:
      type: stdout
